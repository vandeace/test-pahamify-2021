"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./error.js");function r(t,r,e,n){const a=new Error("".concat(n," requires an ID for the ").concat(r," type"));if(void 0===r)throw new Error("".concat(n," requires a resource type"));if(t){if("POST"!==n&&e.length>0)for(const t of e)if(!t.id)throw a}else{if("object"!=typeof e||0===Object.keys(e).length)throw new Error("".concat(n," requires an object or array body"));if("POST"!==n&&!e.id)throw a}}function e(t,r){let e={};for(const r of Object.keys(t))["id","type"].includes(r)?e[r]=t[r]:e=o(t[r],r,e);return e.type||(e.type=r),e}function n(t,r){const n=[];for(const a of t){const t=e(a);t.type||(t.type=r),n.push(t)}return n}function a(t,r,a,o){var s,i;return o.relationships||(o.relationships={}),o.relationships[a]={data:Array.isArray(t.data)?n(t.data,r):e(t.data,r)},(null!=t&&null!==(s=t.links)&&void 0!==s&&s.self||null!=t&&null!==(i=t.links)&&void 0!==i&&i.related)&&(o.relationships[a].links=t.links),null!=t&&t.meta&&(o.relationships[a].meta=t.meta),o}function o(t,r,e){return e.attributes||(e.attributes={}),"links"!==r||"string"!=typeof t.self&&"string"!=typeof t.related?"meta"===r&&t.constructor===Object?e.meta=t:e.attributes[r]=t:e.links=t,e}function s(t){if(!t.data)return!1;const r=Array.isArray(t.data)?t.data[0]:t.data;return Object.prototype.hasOwnProperty.call(r,"id")}function i(t,e,n,i){r(!1,t,e,n);let l={type:t=i.pluralTypes(i.camelCaseTypes(t))};null!=e&&e.id&&(l.id=String(e.id));for(const t in e){const r=e[t],n=i.pluralTypes(i.camelCaseTypes(t));null!==r&&(null==r?void 0:r.constructor)===Object&&s(r)?l=a(r,n,t,l):"id"!==t&&"type"!==t&&(l=o(r,t,l))}return{data:l}}exports.serialise=function(e,n={},a="POST",o={}){try{return o.camelCaseTypes||(o.camelCaseTypes=t=>t),o.pluralTypes||(o.pluralTypes=t=>t),null===n||Array.isArray(n)&&0===n.length?{data:n}:Array.isArray(n)&&(null==n?void 0:n.length)>0?function(t,e,n,a){r(!0,t,e,n);const o=[];for(const r of e)o.push(i(t,r,n,a).data);return{data:o}}(e,n,a,o):i(e,n,a,o)}catch(r){throw t.error(r)}};
